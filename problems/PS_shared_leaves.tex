\documentclass[problem]{mcs}
\begin{pcomments}
  \pcomment{PS_shared_leaves}
  \pcomment{depends on and generalizes CP_leaves_vs_nodes}
  \pcomment{ARM 10/4/17}
\end{pcomments}

\pkeywords{
  trees
  binary_trees
  depth
  sharing
  subtree
  recursive_data
  structural_induction
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
\begin{definition*}
Define the \emph{sharing binary trees} \shbrn\ recursively:

\inductioncase{Base case}: ($T \in \brnch$ is a leaf).  $T \in
\shbrn$.

\inductioncase{Constructor case}: ($T \in \brnchng$).  If
$\leftsub{(T)}, \rightsub{(T)} \in \shbrn$, then $T$ is in \shbrn.
\end{definition*}

\bparts
\ppart Prove $\text{size}(T)$ is finite for every $T \in \shbrn$.

\begin{solution}
The proof of the corresponding Corollary~\bref{cor:finitetree} for
\rectr\ carrries over without change.
\end{solution}

\ppart Give an example of a finite $T \in \brnch$ that has an infinite path.

\begin{solution}
A tree $T \in brnch$ such that $\leftsub{T} = \rightsub{T} = T$ has size one, but every
sequence of selectors
\[
\dots, f_n,\dots,f_1,f_0
\]
is an infinite path for $T$.
\end{solution}

\ppart Prove that for all $T \in \brnch$
\[
T  \in \shbrn \iff T\ \text{has no infinite path}.
\]

\begin{solution}
Same proof as the Fundamental Theorem~\bref{fundthmrec} simplified by
ignoring sharing.
\end{solution}
\eparts

\medskip

For $T \in \shbrn$, define
\begin{align*}
\text{leaves}(T)   & \eqdef \set{S \in \subbrn{T} \suchthat S\ \text{is a leaf}}\\
\text{internal}(T) & \eqdef \set{S \in \subbrn{T} \suchthat S \in \brnchng}
\end{align*}

\bparts
\ppart
Prove that
\begin{lemma*}
If $T \in \shbrn$, then
\[
\card{\text{leaves}(T)} \leq 1 + \card{\text{internal}(T)}.
\]
\end{lemma*}

\hint Show that for every $T\in \shbrn$, there is a recursive tree $R \in
\rectr$ with the same number of internal subtrees and at least as many
leaves.

\begin{solution}

\begin{proof}
If $T \in \shbrn$, if two different paths lead to the same shared
subtree, redefine the endpoint of one of these paths to be a leaf that
is not a leaf of $T$.  Keep doing this until there are no shared
subtrees. The result is a tree $R$ without sharing that has the same
internal subtrees and a set of leaves that includes those of $T$.  Now
$R$ will be a recursive tree without sharing, so

\begin{align*}
\card{\text{leaves}(T)}
& \leq \card{\text{leaves}(R)}\\
& = 1 + \card{\text{internal}(R)}
      & \text{(by Problem~\bref{CP_leaves_vs_nodes})}\\
& = 1 + \card{\text{internal}(T)}
      & \text{(by def $R$)}.
\end{align*}

\end{proof} 
\end{solution}

\eparts

\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
