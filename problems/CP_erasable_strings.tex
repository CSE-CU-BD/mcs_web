\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{CP_erasable_strings}
  \pcomment{from: S09.cp5m}
  \pcomment{related to: S09.cp5m}
\end{pcomments}

\pkeywords{
  induction
  matching_brackets
  recursive_data
  strings
  structural_induction
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  Let $p$ be the string $\lefbrk\rhtbrk$.  A string of
  brackets is said to be \term{erasable} iff it can be reduced to
  the empty string by repeatedly erasing occurrences of $p$.  For
  example, here's how to erase the string
  $\lefbrk\lefbrk\lefbrk\rhtbrk\rhtbrk\lefbrk\rhtbrk\rhtbrk\lefbrk\rhtbrk$:
\[
\lefbrk\lefbrk\lefbrk\rhtbrk\rhtbrk\lefbrk\rhtbrk\rhtbrk\lefbrk\rhtbrk
\rightarrow \lefbrk\lefbrk\rhtbrk\rhtbrk
\rightarrow \lefbrk\rhtbrk
\rightarrow \emptystring.
\]
On the other hand the string $\lefbrk\rhtbrk\rhtbrk\lefbrk\lefbrk\lefbrk\lefbrk\lefbrk\rhtbrk\rhtbrk$ is not erasable because
when we try to erase, we get stuck: %at $\rhtbrk\lefbrk\lefbrk\lefbrk$:
\[
\lefbrk\rhtbrk\rhtbrk\lefbrk\lefbrk\lefbrk\lefbrk\lefbrk\rhtbrk\rhtbrk
\rightarrow \rhtbrk\lefbrk\lefbrk\lefbrk\lefbrk\rhtbrk
\rightarrow \rhtbrk\lefbrk\lefbrk\lefbrk
\not\rightarrow
\]

Let $\ES$ be the set of erasable strings of brackets.  Let $\RM$ be
the recursive data type of strings of \emph{matched} brackets given in
Definition~\bref{RM-def}.

% (The definition of $\RM$ is repeated in the Appendix.)

\bparts

\ppart Use structural induction to prove that
\[
\RM \subseteq \ES.
\]

\begin{solution}
\begin{proof}
We prove by structural induction on the definition of $\RM$ that
  the predicate
\[
P(x) \eqdef x \in \ES
\]
is true for all $x \in \RM$.

\textbf{Base case}: ($x = \emptystring$) The empty string is erasable by
definition of $\ES$---it can be reduced to itself by erasing the
substring $\lefbrk$ 0 times.

\textbf{Constructor case}: ($x = \lefbrk s\, \rhtbrk t$ for $s,t \in \RM$).  By
structural induction hypothesis, we may assume that $s,t \in \ES$.  So to
erase $x$, erase $s$ and then erase $t$ to be left with the substring
$\lefbrk\rhtbrk$, and one more erasure leads to the empty string.

This completes the proof by structural induction, so we conclude that
\[
\forall x.\ x\in \RM\ \QIMPLIES\ x \in \ES
\]
which by definition means that $\RM \subseteq \ES$.

\end{proof}
\end{solution}

\ppart\label{RMES} Supply the missing parts of the following proof that
\[
\ES \subseteq \RM.
\]

\begin{proof}

We prove by induction on the length, $n$, of strings, $x$, that if $x \in
\ES$, then $x \in \RM$.  The induction predicate is
\[
P(n) \eqdef \forall x \in \ES.\, (\lnth{x} \leq n\ \QIMPLIES\ x \in \RM)
\]

\textbf{Base case}:

\textbf{ What is the base case?  Prove that $P$ is true in this case.}

\begin{solution}
The base case is ($n = 0$).  Now $P(0)$ is true because the
  empty string is the only string of length 0, and it is in $\RM$ by the
  base case of Definition~\bref{RM-def} of $\RM$.
\end{solution}

\textbf{Inductive step}: To prove $P(n+1)$, suppose $\lnth{x} \leq n+1$
and $x \in \ES$.  We need only show that $x \in \RM$.  Now if $\lnth{x} <
n+1$, then the induction hypothesis, $P(n)$, implies that $x \in \RM$, so we
only have to deal with $x$ of length exactly $n+1$.

Let's say that a string $y$ is an \emph{erase} of a string $z$ iff $y$ is
the result of erasing a single occurrence of $p$ in $z$.

Since $x \in \ES$ and has positive length, there must be an erase, $y \in
\ES$, of $x$.  So $\lnth{y} = n-1$, and since $y \in \ES$, we may assume
by induction hypothesis that $y \in \RM$.

Now we argue by cases:

\textbf{Case} ($y$ is the empty string).

\textbf{Prove that $x \in \RM$ in this case.}

\begin{solution}
In this case $x = p \in \RM$.
\end{solution}

\textbf{Case} ($y = \lefbrk s\, \rhtbrk t$ for some strings $s, t \in \RM$.)
Now we argue by subcases.
\begin{itemize}

\item \textbf{Subcase} ($x$ is of the form $\lefbrk s'\, \rhtbrk t$ where $s$
  is an erase of $s'$).

  Since $s \in \RM$, it is erasable by part~\eqref{RMES}, which implies
  that $s'\in \ES$.  But $\lnth{s'} < \lnth{x}$, so by induction
  hypothesis, we may assume that $s' \in \RM$.  This shows that $x$ is
  the result of the constructor step of $\RM$, and therefore $x \in \RM$.

\item \textbf{Subcase} ($x$ is of the form $\lefbrk s\, \rhtbrk t'$ where $t$ is an
  erase of $t'$).

  \textbf{Prove that $x \in \RM$ in this subcase.}

\begin{solution}
The proof is essentially identical to the previous case, with
  $t,t'$ in place of $s,s'$:

  Now $t$ is erasable by part~\eqref{RMES}, so $t'\in \ES$.  But
  $\lnth{t'} < \lnth{x}$, so by induction hypothesis, we may assume that
  $t' \in \RM$.  This proves that $x$ is the result of the constructor
  step of $\RM$ and therefore $x \in \RM$.

\end{solution}

\item \textbf{Subcase}($x=p\lefbrk s\, \rhtbrk t$).

  \textbf{Prove that $x \in \RM$ in this subcase.}

\begin{solution}
Let $t' \eqdef \lefbrk s\, \rhtbrk t$ and $s'$ be the empty string.
  Then $x = \lefbrk s'\ \rhtbrk t'$.  But we know $s',t' \in \RM$, which
  implies that $x \in \RM$ because it is the result the $\RM$ constructor
  step applied to $s',t'$.
\end{solution}

\end{itemize}

The proofs of the remaining subcases are just like this last one.
\textbf{List these remaining subcases.}

\begin{solution}\mbox{}

\begin{itemize}

\item \textbf{case} ($x= \lefbrk ps\, \rhtbrk t$),
\item \textbf{case} ($x= \lefbrk sp\, \rhtbrk t$),
\item \textbf{case} ($x= \lefbrk s\, \rhtbrk pt$),
\item \textbf{case} ($x= \lefbrk s\, \rhtbrk tp$).
\end{itemize}

\end{solution}

This completes the proof by induction on $n$, so we conclude that $P(n)$
holds for all $n \in \naturals$.  Therefore $x \in \RM$ for every string
$x \in \ES$.  That is,
\[
\ES \subseteq \RM \text{  and hence  } \ES = \RM.
\]
\end{proof}

\eparts
\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
