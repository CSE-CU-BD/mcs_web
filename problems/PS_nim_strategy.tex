\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_nim_strategy}
  \pcomment{F14.ps2}
  \pcomment{edited ARM 9/24/14}
\end{pcomments}

\pkeywords{
  Nim
  xor
  binary
  strategy
  state_machines
  invariant
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
Nim is a game played between two players starting with one or more
separate nonempty piles of stones; the piles might not be the same
size.  A player's move consists of removing one or more stones from a
single pile.  Players alternate moves, and the loser is the one who is
left with no stones to remove.

It turns out there is a winning strategy for the first player that is
easy to carry out but is not so obvious.  So as long as you're the
first player, it's likely going to be a long time before your opponent
figures out why you keep winning.

To explain the winning strategy, we need to think of a number in two
ways: as a nonnegative integer and as the bit string equal to the
binary representation of the number---possibly with leading zeroes.

For example, the $\QXOR$ of \emph{numbers} $r,s,...$ is defined in
terms of their binary representations: combine the corresponding bits
of the binary representations of $r, s,...$ using $\QXOR$, and then
interpret the resulting bit-string as a number.  For example,
\[
2 \QXOR 7 \QXOR 9 = 12
\]
because, taking $\QXOR$'s down the columns, we have
\[\begin{array}{ccccl}
 0 & 0 & 1 & 0 & \text{(binary rep of 2)}\\
 0 & 1 & 1 & 1 & \text{(binary rep of 7)}\\
 1 & 0 & 0 & 1 & \text{(binary rep of 9)}\\
\hline
 1 & 1 & 0 & 0 & \text{(binary rep of 12)}
\end{array}\]

The $\QXOR$ of the numbers of stones in the piles is called their
\emph{Nim sum}.

\bparts

\ppart\label{zS-nzS} Prove that if the Nim sum of the piles is zero,
then any one move will leave a nonzero Nim sum.

\begin{solution}
When a player removes stones from a pile, the binary representation of
the number of stones in the pile changes.  Since the other piles stay
the same, the bits in the Nim sum change at the positions where bits
changed in the binary representation.  Since all the bits in the Nim
sum were initially equal to zero, the changed bits must have become
ones.  That makes the Nim sum nonzero.
\end{solution}

\ppart\label{if-r>sxt} Prove that if there is a pile with more stones
than the Nim sum of all the other piles, then there is a move that
makes the Nim sum equal to zero.

\begin{solution}
  Remove stones from the pile of size $r$ until it is of size equal to
  the Nim sum, $n$, of the other piles.  That results in a Nim sum
  equal to $n \QXOR n = 0$.
\end{solution}

\ppart\label{nz-r>sxt} Prove that if the Nim sum is not zero, then one
of the piles is bigger than the Nim sum of the all the other piles.

\begin{solution}
 Suppose the Nim sum of all the piles is $s$ and the high order digit
 of the Nim sum, that is, the leftmost 1 in the binary representation
 of $s$, occurs at the $n$th position.  Since this bit of the Nim sum
 equals 1, there must be at least one pile of $r$ stones such that the
 $n$th bit of $r$ is also 1.

 Notice that the Nim sum of all the piles besides the pile of $r$ must
 equal $r \QXOR s$.  This Nim sum has $n$th bit 0, since both $r$ and
 $s$ have $n$th bit 1.  Also, since each bit of $s$ above the $n$th is
 zero, each bit of $r$ above the $n$th must equal the corresponding
 bit of $r \QXOR s$.

 So $r$ and $r \QXOR t$ are the same above the $n$th bit, and $r$ is
 bigger at the $n$th bit.  This implies that $r > r \QXOR s$.  That
 is, $r$ is bigger than the Nim sum of all the other piles, as
 required.
\end{solution}

\ppart Conclude that if the game begins with a nonzero Nim sum, then
the first player has a winning strategy.

\hint Describe a preserved invariant that the first player can
maintain.

\begin{solution}
By part~\eqref{zS-nzS}, whenever it is the second player's turn to
move, and the Nim sum is zero, the second player will leave a Nim sum
that is not zero.

By parts~\eqref{if-r>sxt} and~\eqref{nz-r>sxt}, whenever it is the
first player's turn to move, and the Nim sum is not zero, the first
player can leave the Nim sum equal to zero.

If the first player always moves to set a nonzero Nim sum to zero,
then the Nim sum being nonzero on the first player's turn and zero on
the second player's turn is a preserved invariant of the game.  Also,
the Nim sum at the start is nonzero since the piles start off of equal
size.

Since the total number of stones decreases at every move, the game
must eventually end with no stones and hence Nim sum zero.  By the
preserved invariant, this can only happen on the second player's turn.
That is, the second player must lose.
\end{solution}

\eparts
\end{problem}

\endinput
