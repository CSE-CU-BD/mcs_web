\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{FP_binary_gcd}
  \pcomment{lighter version of PS_binary_gcd}
  \pcomment{By ARM 4/24/11 based on Shoup}
  \pcomment{revised ARM 3/17/14; 5/10/14}
\end{pcomments}

\pkeywords{
  preserved_invariant
  GCD
  binary_GCD
  state_machine
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  The following \idx{Binary GCD} state machine computes the GCD of
  integers $a,b>0$:

\begin{align}
\text{states}  \eqdef     &\naturals^3\notag\\
\text{start state} \eqdef & (a, b, 1)\notag\\
\text{transitions} \eqdef & \text{ if } \min(x,y) > 0, \text{ then } (x,  y, e) \movesto\notag\\
     &  (x/2, y/2, 2e) & \text{(if $2 \divides x$ and $2 \divides y$)}\label{x2y22e}\\
     &  (x/2, y, e)    & \text{(else if $2 \divides x$)}\label{x2ye}\\
     &  (x, y/2, e)    & \text{(else if $2 \divides y$)}\label{xy2e}\\
     &  (y, x, e)      & \text{(else if $y>x$)}\label{xyey>x}\\
     &  (1, 0, ex)     & \text{(else if $x = y$)}\label{xyex=y}\\
     &  (1, 0, e)      & \text{(else if $y=1$)}\label{10ey1}\\
     &  (x-y,y,e)      & \text{(otherwise)}.\label{x-yye}
\end{align}

The predicate
\begin{equation}\label{gcdabexy}
\gcd(a,b) = e\gcd(x,y)
\end{equation}
is claimed to be a preserved invariant of this state machine.

\bparts 

\ppart Verify that equation~\eqref{gcdabexy} is a preserved invariant
under transition rules~\eqref{x2y22e},~\eqref{x2ye},
and~\eqref{x-yye}.  You may assume without proof elementary properties
of GCD, but be sure to state your assumptions explicitly.

\examspace[2.5in]

\begin{solution}
To verify preserved invariance, we assume the invariant holds for
state $(x,y,e)$ and show that if $(x,y,e) \movesto (x',y',e')$, then
$\gcd(a,b) = e'\gcd(x',y')$.

The proof is by cases according to which kind of transition occurs.

\inductioncase{Case}~\eqref{x2y22e}: ($2 \divides x$ and $2 \divides y$).  
In this case, $(x',y',e') = (x/2, y/2, 2e)$.

We use the easily verified fact
\begin{equation}\label{auavauv}
\gcd(au,av) = a\gcd(u,v).
\end{equation}

Now
\begin{align*}
\gcd(a,b)
  & =  e\gcd(x,y)
        & \text{(by the invariant for $(x,y,e)$)}\\
  & = e 2\gcd(x/2,y/2)
        & \text{(by~\eqref{auavauv})}\\
  & = e'\gcd(x',y'),
\end{align*}
which shows that the invariant holds for $(x',y',e')$.

\inductioncase{Case}~\eqref{x2ye}: ($2 \divides x$ and 2 does not divide $y$).
In this case, $(x',y',e') = (x/2,y, e)$.

We use the easily verified fact
\begin{equation}\label{auvvuv}
\gcd(au,v) = \gcd(u,v)
\end{equation}
for $a$ relatively prime to $v$.

Now
\begin{align*}
\gcd(a,b)
  & = e\gcd(x,y)
      & \text{(invariant for $(x,y,e)$)}\\
  & = e\gcd(x/2,y)
      & \text{(by~\eqref{auvvuv})}\\
  & = e'\gcd(x',y'),
\end{align*}
which shows that the invariant holds for $(x',y',e')$.

\inductioncase{Case}~\eqref{x-yye}: (otherwise clause).
In this case $(x',y',e') = (x-y,y,e)$.

We use the easily verified fact that
\begin{equation}\label{gcdu-v}
\gcd(u-v,v) = \gcd(u,v).
\end{equation}

Now,
\begin{align*}
\gcd(a,b)
  & = e\gcd(x,y) & \text{(invariant for $(x,y,e)$)}\\
  & = e\gcd(x-y,y) & \text{(by~\eqref{gcdu-v})}\\
  & = e'\gcd(x',y'),
\end{align*}
proving that the invariant holds for $(x',y',e')$.

Verification of the remaining cases follows similarly.
\end{solution}

\iffalse
\ppart Explain why the only possible stopped states (states where no
transition is possible) are of the form $(1,0,e')$.

\begin{solution}
The start state is not stopped since $\min(a,b)= b > 0$.  Likewise,
the final transition rule to state $(x-y,y,e)$ is also only possible
if $\min(x,y) = y > 0$, so another transition will be possible after
applying this rule.  Moves by the first~\eqref{x2y22e} through
fourth~\eqref{xyey>x} rules do not lead to stopped states, since the
minimum of the new $x$ and $y$ values remains positive.

So only the rules~\eqref{xyex=y} and~\eqref{10ey1} can lead to stopped
states, which in both cases are of the form $(1,0,e')$.
\end{solution}
\fi

\ppart Use the invariant~\eqref{gcdabexy} and the Invariant Principle
to conclude that if this machine reaches a stopped state $(1,0,e')$,
then $e' = \gcd(a,b)$.

\examspace[2in]
\begin{solution}
We first observe that the preserved invariant holds trivially in the
start state $(a,b,1)$ because $\gcd(a,b) = 1\cdot\gcd(a,b)$.  The
Invariant Principle allows us to conclude that the preserved invariant
holds in every reachable state.

If a stopped state $(1,0,e')$ is reachable, then the invariant implies
\[
\gcd(a,b) = e'\gcd(1,0) = e',
\]
as required.
\end{solution}

\ppart Prove that rule~\eqref{x2y22e}
\[
(x, y, e) \to (x/2, y/2, 2e)
\]
is never executed after any of the other rules is executed.

\hint An invariant about the parity of $x$ and $y$.

\begin{solution}
We claim that another preserved invariant is
\begin{equation}\label{xybev}
\QNOT(2 \divides x\ \QAND\ 2 \divides y).
\end{equation}

To verify this, suppose a state $(x,y,e)$ satisfies~\eqref{xybev}.  Then
first rule will not be executed.

Suppose the second rule gets executed resulting in state $(x/2, y ,e)$.
Then $x$ must be even and $y$ must be odd, and so this state
satisfies~\eqref{xybev} since $y$ is odd.

Suppose the last rule gets executed resulting in state $(x-y,y,e)$.
Then if $y$ is odd this state satisfies~\eqref{xybev}, and if $y$ is
even, then $x$ must be odd, so this state satisfies~\eqref{xybev}
because $x-y$ must be odd.

The verification that~\eqref{xybev} is preserved by the other rules
follows by similar routine reasoning.

Now if the first rule is not executed in some state $(x,y,e)$,
then~\eqref{xybev} must hold, and since~\eqref{xybev} is preserved, we
can conclude that the first rule will never be executed in any
subsequent state.
\end{solution}

\eparts

\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
