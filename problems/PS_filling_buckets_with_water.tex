\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_filling_buckets_with_water}
  \pcomment{from: F09.ps4, F02.ps5}
  \pcomment{edited and cut down by ARM 2/26/11}
\end{pcomments}

\pkeywords{
	state_machines
        invariant
        jug
        die_hard
        gcd
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
Let's extend the jug filling scenario of Section~\bref{jug_invar_subsubsec}
to three jugs and a receptacle.
The receptacle can be used to store an unlimited amount of water, but has
no measurement markings.  Excess water can be dumped into the drain.
Among the possible moves are:

\begin{enumerate}

\item\label{hose-bucket} fill a bucket from the hose,

\item pour from the receptacle to a bucket until the bucket is full
or the receptacle is empty, whichever happens first,

\item empty a bucket to the drain,

\item\label{bucket-receptacle} empty a bucket to the receptacle,

\item pour from one bucket to another until either the first is empty or the second is full,

\end{enumerate}

\bparts

\ppart
Model this scenario with a state machine.  (What are the states?  How does
a state change in response to a move?)

\begin{solution}
The states are quadruples $(w,x,y,z)$ which give the current amount of
water in the bucket three buckets and the receptacle, respectively.
The initial state is $(0,0,0,0)$.

\dots rest of proof TBA.

\iffalse

%NEEDS REVISION TO THREE BUCKETS
The moves make the following transitions:
\begin{enumerate}
\item fill a bucket from the hose
\[
(x,y,z) \rightarrow \left \{ \begin{array}{l}
(a,y,z) \mbox{ if filling A from the hose } \\
(x,b,z) \mbox{ if filling B from the hose }
\end{array} \right.
\]

\item pour from the receptacle to a bucket until the bucket is full
or the receptacle is empty, whichever happens first
\[
(x,y,z) \rightarrow \left \{ \begin{array}{l}
(a,y,z-(a-x)) \mbox{ if pouring to A and } z \geq (a-x) \\
(x+z,y,0) \mbox{ if pouring to A and } z < (a-x) \\
(x,b,z-(b-y)) \mbox{ if pouring to B and } z \geq (b-y) \\
(x,y+z,0) \mbox{ if pouring to B and } z < (b-y)
\end{array} \right.
\]

\item empty a bucket to the drain
\[
(x,y,z) \rightarrow \left \{ \begin{array}{l}
(0,y,z) \mbox{ if emptying A to the drain } \\
(x,0,z) \mbox{ if emptying B to the drain }
\end{array} \right.
\]

\item empty a bucket to the receptacle
\[
(x,y,z) \rightarrow \left \{ \begin{array}{l}
(0,y,z+x) \mbox{ if emptying A to the receptacle } \\
(x,0,z+y) \mbox{ if emptying B to the receptacle }
\end{array} \right.
\]

\item pour from $A$ to $B$ until either $A$ is empty or $B$ is full,
whichever happens first
\[
(x,y,z) \rightarrow \left \{ \begin{array}{l}
(0,y+x,z) \mbox{ if } x < (b-y) \\
(x-(b-y),b,z) \mbox{ if } x \geq (b-y)
\end{array} \right.
\]

\item pour from $B$ to $A$ until either $B$ is empty or $A$ is full,
whichever happens first
\[
(x,y,z) \rightarrow \left \{ \begin{array}{l}
(x+y,0,z) \mbox{ if } y < (a-x) \\
(a,y-(a-x),z) \mbox{ if } y \geq (a-x)
\end{array} \right.
\]
\end{enumerate}
\fi

\end{solution}


\ppart \label{gcd-iff}
Prove that Bruce can get $k\in\naturals$ gallons of water into the
receptacle using the above operations only if $\gcd(a,b) \divides k$.

\iffalse
 \hint Use
the fact that if $a,b$ are positive integers then there exist integers
$s,t$ such that $\gcd(a,b)=sa+tb$ from Section~\bref{sec:pulverizer}.

--was (proven Week 5 Notes, \S5.4).
\fi

\begin{solution}
\begin{proof}
TBA

\iffalse
We show that a preserved invariant of our state machine is that
$\gcd(a,b)$ divides $x$, $y$ and $z$.  Thus, in particular $z$ is
always a multiple of $\gcd(a,b)$.

Let's denote $\gcd(a,b)$ by $c$.  The invariant is true in the initial
state $(0,0,0)$.  Each move preserves this invariant because in each
move the new values of $x,y$ or $z$ are always integer linear
combinations of the previous values $x,y,z$ or $a,b$.  For example in
move 2, case 1, the new value of $z$ is expressed by the above formula
with $1x+0y+1z+-1a+0b$.  Since $c$ divides $a$ and $b$, if $c$ divides
$x,y,z$ before the move, then it divides every such linear formula,
and hence it divides the values of $x,y$ and $z$ after each move.
\fi

\end{proof}

\end{solution}

% \ppart Let's restrict the valid moves to numbers~\ref{hose-bucket}
% and~\ref{bucket-receptacle} only.  Prove that there exists a number
% $n$, such that for all integer $k\geq n$, we can fill the receptacle
% with $k$ gallons of water iff $\gcd(a,b) \divides k$.

% \begin{solution}
% Again, pick $s,t$ s.t. $c=\gcd(a,b)=sa+bt$.  If both
% $s,t\geq{0}$ then $(s,t)=(0,1)$ or $(1,0)$, i.e., $a=b$ (check that in
% all other cases $c$ would be greater than either $a$ or $b$, which is
% impossible).  If $a=b$ then $c=a=b$, and for each $k\geq{c}$, $c\divides
% k$, we can fill the receptacle by repeating moves $1$ and $4$
% ${k}/{c}\in\naturals$ times (with any bucket, since $a=b$).

% Clearly it cannot be that both $s,t\leq0$ (or $c$ would be a
% non-positive integer).  So we are left with two cases: $t<0<s$ or
% $s<0<t$.  Assume without loss of generality that $t<0<s$.

% We show that if $k\geq{n}$ for $n=-t{b^2}/{c}$, and $k$ is a
% multiple of $c$, then we can fill the receptacle with $k$ gallons.
% Let's denote $k$ as a multiple of $b$ plus a ``remainder'' in the
% following way:
% %
% $$ k=k_1b+k_2c\mbox{, where
% }k_1,k_2\in\naturals\,\,\wedge\,\,0\leq{k_2}<\frac{b}{c} $$
% %
% We can represent $k$ in this way since it is divisible by $c$.  Notice
% also, that since $k\geq{-t{b^2}/{c}}$, then
% $k_1\geq{-t{b}/{c}}$.  Since $c=sa+bt$, we can rewrite $k$ as
% follows:
% \begin{align*}
% k&=k_1b+k_2c
% \\
% &=k_1b+k_2(sa+bt)
% \\
% &=(k_2s)a+(k_1+k_2t)b
% \end{align*}
% Hence, as long as $k_1\geq{-t{b}/{c}}$, both $(k_2s)$ and $(k_1+k_2t)$
% are non-negative integers.  And hence, we can fill the receptacle by
% $(k_2s)$ times pouring bucket $A$ into it, and then $(k_1+k_2t)$ times
% bucket $B$, both just with moves $1$ and $4$.
%
% \end{solution}
\eparts
\end{problem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
