\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{CP_RSA_proving_correctness}
  \pcomment{from: S09.cp8r}
\end{pcomments}

\pkeywords{
  number_theory
  modular_arithmetic
  primes
  RSA
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  A critical fact about \idx{RSA} is, of course, that decrypting an
  encrypted message, $m^*$, always gives back the original message,
  $m$.  Namely, if $n=pq$ where $p$ and $q$ are distinct primes, $m
  \in [0,pq)$, and
\[
d\cdot e \equiv 1 \pmod{(p-1)(q-1)},
\]
then
\begin{equation}\label{mdepq=m}
\rem{\rem{m^d}{pq}^e}{pq} = m.
\end{equation}
We'll now prove this.

\bparts

\iffalse

This will follow from something simpler and more general:

\begin{lemma*}%\label{npdp}
If $n$ is a product of distinct primes and $a \in \naturals$ is
$\equiv 1\, (\emph{\textrm{mod}}\,{\phi(n)})$, then $m^a \equiv m \pmod {n}$.
\end{lemma*}

\ppart Explain why the Lemma implies that $k$ and $k^5$ have the
same last digit.  For example:
%
\[
\underline{2}^5 = 3\underline{2}
\hspace{1in}
7\underline{9}^5 = 307705639\underline{9}
\]
\hint What is $\phi(10)$?

\begin{solution}
Two nonnegative integers have the same last digit iff they are $\equiv
\pmod {10}$.  Now $\phi(10) = \phi(2)\phi(5) = 4$ and $5 \equiv 1
\pmod {4}$, so by the Lemma,
\[
k^5 \equiv k \pmod {10}.
\]
\end{solution}
\fi

\ppart\label{cong->decode} Verify that for all $d,e \in \naturals$, if
\begin{equation}\label{mdeqvmpq}
(m^{d})^e \equiv m \pmod {pq},
\end{equation}
then~\eqref{mdepq=m} is true.

\begin{staffnotes}
  If a team is stuck, have them first prove that~\eqref{mdeqvmpq}
  implies that~\eqref{mdepq=m} holds as a congruence mod $pq$, that
  is~\eqref{mdeqvmpq} implies
\[
\rem{\rem{m^d}{pq}^e}{pq} \equiv m \pmod {pq}.
\]
\end{staffnotes}

\begin{solution}
If congruence~\eqref{mdeqvmpq} is true, then replacing $m^{d}$ by its
remainder modulo $pq$ preserves the congruence,\footnote{See
  Corollary~\bref{aran} of the Remainder Lemma~\bref{lem:conrem}.}
giving
\[
\rem{m^d}{pq}^e \equiv m \pmod {pq}.
\]
Now replacing the left hand side by its remainder yields
\[
\rem{\rem{m^d}{pq}^e}{pq} \equiv m \pmod {pq}.
\]
Since both the left and right hand sides of the previous congruence are in
$[0,pq)$, they must be equal, which proves~\eqref{mdepq=m}.
\end{solution}

\ppart\label{pma} Prove that if $p$ is prime, then $m^a \equiv m \pmod
            {p}$ for all $a \in \naturals$ congruent to 1 mod $p-1$.

\begin{solution}
If $p \divides m$, then the congruence holds since both sides are
$\equiv 0 \pmod {p}$.  So assume $p$ does not divide $m$.  Now if $a
\equiv 1 \pmod{p-1}$, then $a = 1 + (p-1)k$ for some $k$, so
\begin{align*}
m^a & = m^{1+ (p-1)k}\\
    & = m\cdot \paren{m^{p-1}}^k\\
    & \equiv m\cdot (1)^k \pmod {p}
            & \text{(by Fermat's Little Thm.)}\\
    & \equiv m \pmod {p}.
\end{align*}
\end{solution}

\iffalse

\ppart\label{abk} Show that for any positive integers $j,k$,
if $a \equiv b \pmod k$ and $j \divides k$, then $a \equiv b \pmod j$

\begin{solution}

$a \equiv b \pmod k$ iff $k \divides (a-b)$.  But if $k \divides (a-b)$
and $j \divides k$, then also $j \divides (a-b)$, which implies $a \equiv
b \pmod j$.

\end{solution}
\fi

\ppart\label{abp} Prove that if $a \equiv b \pmod {p_i}$ for distinct
primes $p_1,p_2,\dots,p_n$, then $a \equiv b \pmod{p_1p_1\cdots
p_n}$.

\begin{solution}
By definition of congruence, $a \equiv b \pmod {k}$ iff $k \divides
(a-b)$.  So if $a \equiv b \pmod {p_i}$ for each $p_i$, then $p_i
\divides (a-b)$ for each $p_i$.  By the Unique Factorization
Theorem~\bref{thm:unique_factor}, the product of the $p_i$'s must also
divide $(a-b)$, which means that $a \equiv b \pmod {p_1p_1\cdots p_n}$.
\end{solution}

\iffalse

\ppart\label{phip} Verify that for any $n>1$ and any prime divisor, $p$,
of $n$,
\[
\phi(p) \divides \phi(n).
\]

\begin{solution}
Let $p$ be a prime factor of $n$ and factor $n$ as $m\cdot p^k$
where $p$ does not divide $m$.  By the Euler function equations,
$\phi(n)=\phi(m)\phi(p^k)$, so $\phi(p^k) \divides \phi(n)$.  But
$\phi(p) = (p-1)$ which divides $(p-1)p^{k-1} = \phi(p^k)$.
\end{solution}
\fi

\ppart Prove
\begin{lemma*}%\label{npdp}
If $n$ is a product of distinct primes and $a \in \naturals$ is
$\equiv 1\, (\emph{\textrm{mod}}\,{\phi(n)})$, then $m^a \equiv m \pmod {n}$.
\end{lemma*}

\begin{solution}
Suppose $n$ is a product of distinct primes,
  $p_1p_2\cdots p_k$.  Then from the formulas for the Euler function,
  $\phi$, we have
\[
\phi(n) = (p_1 -1)(p_2 -1)\cdots (p_k-1).
\]

Now suppose $a \equiv 1 \pmod{\phi(n)}$, that is, $a$ is 1 plus a
multiple of $\phi(n)$.   So $a$ is also 1 plus a multiple of $p_i-1$, namely,
\[
a \equiv 1 \pmod {p_i - 1}.
\]
Hence, by part~\eqref{pma},
\[
m^a \equiv m \pmod{p_i}
\]
for all $m$.  Since this holds for all factors, $p_i$, of $n$, we conclude
from part~\eqref{abp} that
\[
m^a \equiv m \pmod{n},
\]
which proves the Lemma.
\end{solution}

\ppart Combine the previous parts to complete the proof
of~\eqref{mdepq=m}.

\begin{solution}
By part~\eqref{cong->decode}, we need only prove~\eqref{mdeqvmpq}.

Now for $n=pq$, we have from Lemma~\bref{phi_pq} ---or the more
general Theorem~\bref{th:phi} ---that $\phi(n) = (p-1)(q-1)$, so
$a \eqdef d \cdot e \equiv 1 \pmod {\phi(n)}$.  Now the Lemma implies
\[
m^a \equiv m \pmod {n},
\]
and this implies~\eqref{mdeqvmpq} since $m^a = m^{d \cdot e}=
(m^d)^e$.
\end{solution}

\eparts

\end{problem}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
