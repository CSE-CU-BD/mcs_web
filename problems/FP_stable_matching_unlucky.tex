\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{FP_stable_matching_unlucky}
  \pcomment{version of PS_stable_matching_unlucky}
\end{pcomments}

\pkeywords{
  stable_matching
  state_machines
  invariant
  average
}

\providecommand{\boys}{\text{Boys}}
\providecommand{\girls}{\text{Girls}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
  In a stable matching between $n$ boys and $n$ girls produced by the
  Mating Ritual, call a person \term*{lucky} if they are matched up
  with one of their top $\ceil{n/2}$ choices.  

  Let $a$ be the average number of times a boy gets rejected by girls.

\bparts

\ppart\label{boyavn2} Prove that if $a \leq n/2$, then there is a lucky boy.

\begin{solution}
It's not possible for all the boys to be rejected an above average
number of times, so some boy gets rejected $\leq a$ times.  Now this
boy gets rejected at most $\floor{n/2}$ times, and so he marries a
girl among his top $\ceil{n/2}$ choices, which makes him lucky.

\end{solution}

\examspace[1.5in]

\ppart Conclude that there is always a lucky person.

\begin{solution}
By part~\eqref{boyavn2}, we may assume $a > n/2$.

Since the total of number rejections is the same for the boys and the
girls, $a$ is also the average number of times a girl rejects boys.

It's not possible for all the girls to reject boys a below average
number of times, so some girl rejects $/geq a$ boys.  By the basic
preserved invariant of the Mating Ritual, her preference for her
current suitor does not decrease.  Since she has rejected more than
$n/2$ suitors, the final suitor whom she marries must be among her
top $\ceil{n/2}$ choices, which makes her lucky.
\end{solution}

\eparts

\end{problem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\endinput

\begin{solution}

\begin{staffnotes}
Lemma is unnecessary, see PS\_ version.
Lemma made into problem TP_stable_wedding.
\end{staffnotes}

We prove the following lemma first:

\begin{lemma*}
There exists a girl who gets serenaded for the first time on the
wedding day.
\end{lemma*}

\begin{proof}
Since there are an equal number of boys and girls, the wedding day is
when every girl is being serenaded by some (necessarily only one) boy.

Since ``being serenaded'' is a preserved invariant, any girl being
serenaded on some day continues being serenaded until the wedding day.
So if every girl has been serenaded on some day before the wedding
day, then all the girls are being serenaded on some day before the
wedding day, Thus the day before the wedding day should be the wedding
day, a contradiction.

\end{proof}

Assuming all boys are unlucky, the total number of rejections received
by the boys is at least $n(n/2)$.  Because one girl did not reject
anyone, these rejections need to be supplied by $n-1$ girls.  So on
average, every girl need to reject $n(n/2)/(n-1) > \floor{n/2}$ times.
At least one girl need to reject at least an average number of boys,
that is at least $\floor{n/2}$ times, and she is the lucky girl.
\end{solution}
