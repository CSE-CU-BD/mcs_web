%PS_binomial_problem

\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{PS_linear_recur_closed_form}
  \pcomment{from: F06.ps8 modified to use generating function}
\end{pcomments}

\pkeywords{
  generating_functions
  linear_recurrence
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}

  Let $x_0 \eqdef 0, x_1 \eqdef 1$ and for $n \geq 2$, let $x_n$ be
  defined by the linear recurrence:

  % \bparts

%   \ppart $x_{n} = 12 x_{n-2} - 16 x_{n-3} \quad
%     (x_0 = 1, x_1 = 2, x_2 = 3)$
% 
%   Hint: 2 is a root.
% 
% \begin{solution}
%   The characteristic equation is $r^3 - 12 r +  16 = 0$.
%   Solving a cubic equation can be messy process, but in this case the
%   roots are easy to find:
%   \begin{align*}
%   r_1 & =  2 \\
%   r_2 & =  2 \\
%   r_3 & = -4 
%   \end{align*}
% 
%   Therefore a general form for a solution is
%   \[
%   x_n  = A 2^n + B n 2^n + C (-4)^n.
%   \]
% 
%   Substituting the initial conditions into this general form gives a
%   system of linear equations.
%   \begin{align*}
%   1 & =  A + C \\
%   2 & =  2 A + 2 B -4 C \\
%   3 & =  4 A + 8 B + 16 C
%   \end{align*}
% 
%   The solution to this linear system is $A = 37/36$, $B = -1/12$, and
%   $C = -1/36$.  The complete solution to the recurrence is therefore
%   \[
%   x_n  =  \frac{37}{36}2^{n} - \frac{1}{12}n 2^{n} - \frac{1}{36}(-4)^{n}.
%   \]
% \end{solution}

  % \ppart
  \[
  x_{n} = 3x_{n-1} - 2 x_{n-2} + n.  % \quad (x_0 = 0, x_1 = 1)
  \]
  Find a closed form expression for $x_n$.  

\iffalse
  \hint The solution should be of the form 
  \[
  x_n = A \cdot 2^n + B \cdot n^2 + C \cdot n + D.
  \]
\fi

\begin{solution}
  
  We begin by finding the generating function for the sequence as defined
  by the recurrence:
  
  \[
  \ang{0,\ 1,\ 3 f_1 - 2 f_0 + 2,\ 3 f_2 - 2 f_1 + 3,\ 3 f_2 - 2 f_1 + 4,\ \dots}
  \]
  
  We can do this by breaking the sequence into a sum of three sequences:
  
  \[
  \begin{array}{ccccccccccl}
    & \langle & 0, & 3 f_0, & 3 f_1, & 3 f_2, & \dots & \rangle
      & \corresp & 3 x F(x) \\
    & \langle & 0, & 0, & -2 f_0, & -2 f_1, & \dots & \rangle
      & \corresp & -2 x^2 F(x) \\
  + & \langle & 0, & 1, & 2, & 3, & \dots & \rangle
      & \corresp & \frac{x}{(1-x)^2} \\ \hline
    & \langle & 0, & 3 f_0 + 1, & 3 f_1 - 2 f_0 + 2, & 3 f_2 - 2 f_1 + 3, & \dots & \rangle
      & \corresp & 3 x F(x) - 2 x^2 F(x) + \frac{x}{(1-x)^2} \\
  \end{array}
  \]
  
  As we can see, the sum of the three sequences is equal to the sequence defined by the 
  recurrence, so we may solve for $F(x)$ by solving the following:
  \[
  F(x) = 3 x F(x) - 2 x^2 F(x) + \frac{x}{(1-x)^2}
  \]
  So
  \[
  F(x) \cdot (1 - 3x + 2x^2) = \frac{x}{(1-x)^2}
  \]
  Therefore, the generating function is (note that we may factor $(1 - 3x + 2x^2)$ into $(1 - 2x)(1 - x)$):
  \[
  F(x) = \frac{x}{(1-x)^3 \cdot (1-2x)}
  \]
  
  Now, to find the closed form for the $n$th coefficient of this generating function, 
  let's expand $F(x)$ into partial fractions:
  \[
  \frac{x}{(1-x)^3 \cdot (1-2x)} = \frac{A}{(1-x)^3} + \frac{B}{(1-x)^2} + \frac{C}{1-x} + \frac{D}{1-2x}
  \]
  
  To find $A$, we can multiply both sides by $(1-x)^3 \cdot (1-2x)$ and substitute 1 for x, so:
  \[
  (1) = A \cdot (1-2(1))
  \]
  Therefore, we find that $A = -1$.
  
  We can solve for the other terms via a similar process:
  \begin{gather*}
  A = -1 \\
  B = -1 \\
  C = -2 \\
  D = 4
  \end{gather*}
  
  Substituting back into the equation:
  \[
  \frac{x}{(1-x)^3 \cdot (1-2x)} = - \frac{1}{(1-x)^3} - \frac{1}{(1-x)^2} - \frac{2}{1-x} + \frac{4}{1-2x}
  \]
  
  Each term in the partial fraction expansions has a simple power series:
  \begin{align*}
  - \frac{1}{(1-x)^3} & = - (1 + 3x + 6x^2 + \dots + \frac{(n+1)(n+2)}{2}x^n) \\
  - \frac{1}{(1-x)^2} & = - (1 + 2x + 3x^2 + \dots + (n+1)x^n) \\
  - \frac{2}{1-x} & = -2 (1 + x + x^2 + \dots + x^n) \\
  \frac{4}{1-2x} & = 4 (1 + 2x + 2x^2 + \dots + 2^n x^n)
  \end{align*}
  
  (Note that $\frac{1}{(1-x)^3}$ is $\frac{1}{2}$ the derivative of $\frac{1}{(1-x)^2}$, so
  its coefficient for $x^n$ is $\frac{1}{2}$ the coefficient of $\frac{1}{(1-x)^2}$ left shifted by 1 
  and multiplied by $(n+1)$.)
  
  Summing up the coefficient of $x^n$ in each of these power series gives us:
  \begin{align*}
  x_{n} & = - \frac{(n+1)(n+2)}{2} - (n+1) - 2 + 4 \cdot 2^n \\
        & = - \frac{1}{2} n^2 - \frac{3}{2} n - 1 - n - 1 - 2 + 4 \cdot 2^n \\
        & = - \frac{1}{2} n^2 - \frac{5}{2} n - 4 + 2^{(n+2)}
  \end{align*}
  
\end{solution}

  % \eparts



\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
