\documentclass[problem]{mcs}

\begin{pcomments}
  \pcomment{TP_sub_one_with_two_of_opposite_color}
  \pcomment{proposed for midterm II, Fall15}
  \pcomment{author: Zoran Dzunic}
\end{pcomments}

\pkeywords{
  state_machines
  derived_variable
  induction
  congruences
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem starts here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{problem}
``Token replacing'' is single player game using a set of tokens, each
  colored black or white.  Except for color, the tokens are
  indistinguishable.  In each move, a player can replace one black
  token with two white tokens, or replace one white token with two
  black tokens.

  We can model this game as a state machine whose states are pairs
  $(n_b,n_w)$ where $n_b \geq 0$ equals the number of black tokens and
  $n_w \geq 0$ equals the number of white tokens.

\iffalse
There is no further labeling of the tokens of the same color (e.g., we
don't care which of the black tokens appeared first, second, etc.),
and the order of tokens does not matter (e.g., sequence 'bbw' is
the same as sequence 'bwb').
\fi

\bparts

\iffalse
\ppart
Model this game as a state machine, carefully defining the set of
states, the start state and the possible state transitions.
\hint Be sure to state the conditions of the state transitions.
\begin{solution}
A state of this game is fully described with a pair of nonnegative integer
numbers $(n_b, n_w)$, where $n_b$ and $n_w$ are the numbers of black and
white tokens, respectively. State transitions are of the form
$(n_b, n_w) \rightarrow (n_b-1, n_w+2)$ if $n_b > 0$, and
$(n_b, n_w) \rightarrow (n_b+2, n_w-1)$ if $n_w > 0$ 
\end{solution}

\examspace[2.0in]
\fi

%{\color{red} VARIANT 1}

\ppart Put a check next to each of the following predicates that are
preserved invariants:

\begin{enumerate}
\item $n_b + n_w \equiv 1 \pmod{3}$ \hfill\examrule[0.5in]

\item $n_w - n_b \equiv 2 \pmod{3}$ \hfill\examrule[0.5in]

\item $n_b - n_w \equiv 2 \pmod{3}$ \hfill\examrule[0.5in]
%\item $2 n_b - n \equiv 1 \pmod{3}$ \hfill\examrule[0.5in]
%\item $n_b + n \equiv 2 \pmod{3}$ \hfill\examrule[0.5in]

\item $2n_b + n_w \equiv 2 \pmod{3}$ \hfill\examrule[0.5in]
\end{enumerate}

\begin{solution}
\begin{enumerate}
\item $n_b + n_w \equiv 1 \pmod{3}$ -- {\bf False}
\item $n_w - n_b \equiv 2 \pmod{3}$ -- {\bf True}
\item $n_b - n_w \equiv 2 \pmod{3}$ -- {\bf True}
%\item $2 n_b - n \equiv 1 \pmod{3}$ -- {\bf True}
\item $2n_b + n_w \equiv 2 \pmod{3}$ -- {\bf True}
\end{enumerate}

\TBA{Proof and counterexamples}
\end{solution}

\iffalse
\ppart  
Which of the preceding are true for the start state?

\begin{solution}
\begin{enumerate}
\item $n_b + n_w = 1\equiv 1 \pmod{3}$ -- {\bf True}
\item $n_w - n_b = -1\equiv 2 \pmod{3}$ -- {\bf True}
\item $n_b - n_w = 1 \not\equiv 2 \pmod{3}$ -- {\bf False}
\item $2 n_b + n_w = 2 \not\equiv 1 \pmod{3}$ -- {\bf False}
%\item $n_b + n \equiv 2 \pmod{3}$ -- {\bf True}
\end{enumerate}
\end{solution}
\fi

\ppart Suppose the game starts with one black token and no white
tokens.  Put a check next to each of the following predicates that are
true for all reachable states.

\begin{staffnotes}
If needed, provide the following hint.
\hint{Which are true of the start state?}
%Use the invariant principle.}
\end{staffnotes}

\begin{solution}
\begin{enumerate}
\item $n_b + n_w \equiv 1 \pmod{3}$ -- {\bf False}
\item $n_w - n_b \equiv 2 \pmod{3}$ -- {\bf True}
\item $n_b - n_w \equiv 2 \pmod{3}$ -- {\bf False}
%\item $2 n_b - n \equiv 1 \pmod{3}$ -- {\bf True}
\item $2n_b + n_w \equiv 2 \pmod{3}$ -- {\bf True}
\end{enumerate}

 The first and third predicates are false in the start state and so
 are not true of all reachable states.  The second and fourth
 predicates are true in the start state and are also preserved
 invariants, so by the invariant principle, they true for all
 reachable states.
\end{solution}

\examspace[1.0in]

\ppart Let
\[
R(n) \eqdef \set{\text{reachable states }(n_b,n_w) \suchthat n =  n_b+n_w}.
\]
Here ``reachable'' refers to states reachable starting with exactly
one black token.

Define
\[
S(n) \eqdef \set{(n_b, n_w) \suchthat n_b + n_w = n \QAND
\iffalse n_b \ge 0, n_w \ge 0,\fi
n_w - n_b \equiv 2 \pmod{3}}.
\]

Prove by induction on $n$ that
\[
R(n)=S(n).
\]

\iffalse
Let $P$ be any predicate above that is true for all reachable states. This predicate may also be
true for some unreachable states.  Using induction on $n$, prove that all states that satisfy
$P$ and for which $n_b, n_w \ge 0$ are reachable.
\fi

\examspace{5in}

\begin{solution}
The induction hypothesis is that $R(n)=S(n)$.

\inductioncase{Base case}: ($n = 1$).  Since $n$ increases as every
step, the only reachable state with $n=1$ is the start state $(1,0)$,
so $R(1) = \set{(1,0)}$.  But $S(1)$ also equals $\set{(1,0)}$ by
definition, which proves this base case.

\inductioncase{Inductive step}:

Assume that the induction hypothesis holds for $n \ge 1$.

Suppose $(n'_b, n'_w) \in S(n+1)$ (and/or $(n'_b, n'_w) \in R(n+1)$??)
for some $n \geq 1$.  Then either $n'_b \ge 2$ or $n'_w \ge 2$.

TBA{REVISE:}

We prove this by cases.  If $n+1=2$, the only \textbf{POSSIBLE
  STATE??} is $(n'_b, n'_w) = (0, 2)$.  If $n+1 > 2$, then by assuming
$n'_b \le 1$ and $n'_w \le 1$, $n+1 = n'_b + n'_w \le 2$ must hold,
which is a contradiction.

As a consequence, either state $(n'_b-2, n'_w+1)$ or state $(n'_b+1,
n'_w-2)$ is a valid state with $n$ tokens and must be reachable by the
assumption.  Since there is a transition form that state to $(n'_b,
n'_w)$, $(n'_b, n'_w)$ is also reachable.
\end{solution}

\examspace[4.0in]

\iffalse
\ppart
Why do you think the proof above holds regardless of which predicate above you chose?

\begin{solution}
Any of the given predicates is preserved in a ``reverse'' move.
\end{solution}
\fi

%\examspace[1.0in]

{\color{red} VARIANT 2}

\ppart
Let $n$ denote the total number of tokens, $n_b$ the number of black tokens,
and $n_w$ the number of white tokens at any step.

Prove that $n_w - n_b \equiv 2 \pmod{3}$ is true for all reachable states.

\begin{solution}
The start state is $(n_b, n_w) = (1, 0)$, so $n_w - n_b = -1 \equiv 2 \pmod{3}$.
Now, assume that the invariant holds for state $(n_b, n_w)$.
If a black token is substituted, then a tranisition is made to the state
$(n'_b, n'_w) = (n_b-1, n_w+2)$, and
$n'_w - n'_b = n_w+2 - (n_b-1) = n_w - n_b + 3 \equiv n_w - n_b \equiv 2 \pmod{3}$.
If a white token is substituted, then a tranisition is made to the state
$(n'_b, n'_w) = (n_b+2, n_w-1)$, and
$n'_w - n'_b = n_w-1 - (n_b+2) = n_w - n_b - 3 \equiv n_w - n_b \equiv 2 \pmod{3}$.
In both cases, the property is preserved.
Since the stated predicate is a preserved invariant and is true for the start state,
by the invariant principle it must be true for all reachable states.
\end{solution}

\examspace[2.0in]

\ppart
Prove that $S = \{(n_b, n_w) \,|\, n_b \ge 0, n_w \ge 0, n_w - n_b \equiv 2 \pmod{3}\}$ is the set
of all reachable states.

\hint{Use induction on $n$.}

\begin{solution}
We will prove this by induction on $n$.

\inductioncase{Induction Hypothesis}:
Let $S(n) = \{(n_b, n_w) \,|\, n_b + n_w = n, n_b \ge 0, n_w \ge 0, n_w - n_b \equiv 2 \pmod{3}\}$.
$P(n) ::= Set S(n) \text{contains all reachable states with} n \text{tokens.}, n \ge 1$ 

\inductioncase{Base case}: ($n = 1$).
The only valid state for $n=1$ is $(n_b, n_w) = (1,0)$, which is the starting
state and is therefore reachable. $(1, 0) \in S(1)$, and so the hypothesis $P(1)$
is true.

\inductioncase{Inductive step}:
Assume that the induction hypothesis $P(n)$ holds for $n \ge 1$, i.e.,
$\forall (n_b, n_w) \in S(n)$, $(n_b, n_w)$ is the set of reachable states with $n$ tokens.

All reachable states with $n+1$ tokens are in $S(n+1)$ since they must satisfy the definition
of $S(n+1)$ (recall that we showed that $n_w - n_b \equiv 2 \pmod{3}$ holds for all reachable states).

Now, we prove that every state in $S(n+1)$ is reachable.

Let $(n'_b, n'_w) \in S(n+1)$.
Either $n'_b \ge 2$ or $n'_w \ge 2$ is true, which we prove by cases. If $n+1=2$,
the only possible state is $(n'_b, n'_w) = (0, 2)$. If $n+1 > 2$, then by assuming
$n'_b \le 1$ and $n'_w \le 1$, $n+1 = n'_b + n'_w \le 2$ must hold, which is
a contradiction.
If $n'_b \ge 2$, then $(n'_b-2, n'_w+1) \in S(n)$
since $n'_w+1 - (n'_b-2) = n'_w-n'_b+3 \equiv n'_w - n'_b \equiv 2\pmod{3}$,
and thefore $(n'_b, n'_w)$ is reachable by a transition from $(n'_b-2, n'_w+1)$
(by replacing a white token).
Similarly, if $n'_w \ge 2$, then $(n'_b+1, n'_w-2) \in S(n)$,
and $(n'_b, n'_w)$ is reachable by a transition from $(n'_b+1, n'_w-2)$
(by replacing a black token).
\end{solution}

\examspace[4.0in]
\iffalse

{\color{red} VARIANT 3 (harder)}

\ppart
Let $n$ denote the total number of tokens, $n_b$ the number of black tokens,
and $n_w$ the number of white tokens at any step.

Write down any predicate that is a function of $n_b$ and $n_w$ and is a preserved invariant.

\begin{solution}
$P ::= n_w - n_b \equiv 2 \pmod{3}$ (equivalent expressions can be made).
\end{solution}

\examspace[1in]

\ppart
Prove that it is indeed a preserved invariant.

\begin{solution}
The start state is $(n_b, n_w) = (1, 0)$, so $n_w - n_b = -1 \equiv 2 \pmod{3}$.
Now, assume that the invariant holds for state $(n_b, n_w)$.
If a black token is substituted, then a tranisition is made to the state
$(n'_b, n'_w) = (n_b-1, n_w+2)$, and
$n'_w - n'_b = n_w+2 - (n_b-1) = n_w - n_b + 3 \equiv n_w - n_b \equiv 2 \pmod{3}$.
If a white token is substituted, then a tranisition is made to the state
$(n'_b, n'_w) = (n_b+2, n_w-1)$, and
$n'_w - n'_b = n_w-1 - (n_b+2) = n_w - n_b - 3 \equiv n_w - n_b \equiv 2 \pmod{3}$.
In both cases, the variant is preserved.
\end{solution}

\examspace[2.0in]

\ppart
Describe the set of all reachable states.

\begin{solution}
$S = \{(n_b, n_w) \,|\, n_b \ge 0, n_w \ge 0, n_w - n_b \equiv 2 \pmod{3}\}$
\end{solution}

\examspace[1.0in]

\ppart
Prove that it is indeed the set of all reachable states.

\hint{Use induction on $n$.}

\begin{solution}
We will prove this by induction on $n$.

\inductioncase{Induction Hypothesis}:
Let $S(n) = \{(n_b, n_w) \,|\, n_b + n_w = n, n_b \ge 0, n_w \ge 0, n_w - n_b \equiv 2 \pmod{3}\}$.
$P(n) ::= \text{Set } S(n) \text{ contains all reachable states with } n \text{ tokens}, n \ge 1$ 

\inductioncase{Base case}: ($n = 1$).
The only valid state for $n=1$ is $(n_b, n_w) = (1,0)$, which is the starting
state and is therefore reachable. $(1, 0) \in S(1)$, and so the hypothesis $P(1)$
is true.

\inductioncase{Inductive step}:
Assume that the induction hypothesis $P(n)$ holds for $n \ge 1$, i.e.,
$\forall (n_b, n_w) \in S(n)$, $(n_b, n_w)$ is the set of reachable states with $n$ tokens.

All reachable states with $n+1$ tokens are in $S(n+1)$ since they must satisfy the definition
of $S(n+1)$ (recall that $n_w - n_b \equiv 2 \pmod{3}$ is an invariant and must hold
for all states).

Now, we prove that every state in $S(n+1)$ is reachable.

Let $(n'_b, n'_w) \in S(n+1)$.
Either $n'_b \ge 2$ or $n'_w \ge 2$ is true, which we prove by cases. If $n+1=2$,
the only possible state is $(n'_b, n'_w) = (0, 2)$. If $n+1 > 2$, then by assuming
$n'_b \le 1$ and $n'_w \le 1$, $n+1 = n'_b + n'_w \le 2$ must hold, which is
a contradiction.
If $n'_b \ge 2$, then $(n'_b-2, n'_w+1) \in S(n)$
since $n'_w+1 - (n'_b-2) = n'_w-n'_b+3 \equiv n'_w - n'_b \equiv 2\pmod{3}$,
and thefore $(n'_b, n'_w)$ is reachable by a transition from $(n'_b-2, n'_w+1)$
(by replacing a white token).
Similarly, if $n'_w \ge 2$, then $(n'_b+1, n'_w-2) \in S(n)$,
and $(n'_b, n'_w)$ is reachable by a transition from $(n'_b+1, n'_w-2)$
(by replacing a black token).
\end{solution}

\examspace[4.0in]
\fi

\eparts
\end{problem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Problem ends here
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\endinput
